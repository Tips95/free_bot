# Telegram Bot - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–∞—Ä—Ñ—é–º–µ—Ä–∏—é

Production-ready Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä—Ñ—é–º–µ—Ä–∏–∏ –ø–æ –∑–∞–∫—É–ø–æ—á–Ω—ã–º —Ü–µ–Ω–∞–º —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π.

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- ‚úÖ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ FSM-–∞–Ω–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ 3 —Ç–∞—Ä–∏—Ñ–∞ (Monthly, Half-year, Yearly)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å YooKassa –¥–ª—è –æ–ø–ª–∞—Ç—ã
- ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –±–æ–Ω—É—Å–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ
- ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–∞–∫—Ä—É—Ç–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- SQLite (–∏–ª–∏ –¥—Ä—É–≥–∞—è –ë–î, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è SQLAlchemy)

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```

4. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Telegram Bot
BOT_TOKEN=your_bot_token_here
BOT_USERNAME=your_bot_username  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

# Database (SQLite –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
DATABASE_URL=sqlite+aiosqlite:///./bot.db

# YooKassa
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=your_secret_key  # test_* –¥–ª—è —Ç–µ—Å—Ç–∞, live_* –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω
YOOKASSA_WEBHOOK_URL=https://your-domain.com/webhook  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

# Test Mode (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É –∫–ª—é—á–∞)
# TEST_MODE=true  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å

# WhatsApp –º–µ–Ω–µ–¥–∂–µ—Ä–∞
MANAGER_WHATSAPP=+7999-399-57-95

# Admin Telegram ID (–¥–ª—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –±–æ–Ω—É—Å–∞—Ö)
ADMIN_TELEGRAM_ID=123456789  # –í–∞—à Telegram ID (–º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —É @userinfobot)
```

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:

```bash
python main.py
```

### –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**
```bash
# 1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª
nano .env

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ screen –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
screen -S bot
python3 main.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ systemd –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
# –°–æ–∑–¥–∞–π—Ç–µ /etc/systemd/system/bot.service —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
```

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### –¢–∞–±–ª–∏—Ü—ã:

- **users** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞
- **tariffs** - –¢–∞—Ä–∏—Ñ—ã –ø–æ–¥–ø–∏—Å–∫–∏
- **subscriptions** - –ü–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **payments** - –ü–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ YooKassa
- **referrals** - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏
- **referral_bonuses** - –í—ã–¥–∞–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã

## üì¶ –¢–∞—Ä–∏—Ñ—ã

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–∑–¥–∞—é—Ç—Å—è 3 —Ç–∞—Ä–∏—Ñ–∞:

| –¢–∞—Ä–∏—Ñ | –°—Ä–æ–∫ | –¶–µ–Ω–∞ |
|-------|------|------|
| Monthly | 1 –º–µ—Å—è—Ü | 249 ‚ÇΩ |
| Half-year | 6 –º–µ—Å—è—Ü–µ–≤ | 1499 ‚ÇΩ |
| Yearly | 12 –º–µ—Å—è—Ü–µ–≤ | 1999 ‚ÇΩ |

–¢–∞—Ä–∏—Ñ—ã –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î.

## üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–≤—è–∑—å
- –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–º, —Å–≤—è–∑—å –æ—Ç–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –æ–ø–ª–∞—á–µ–Ω–Ω–∞—è
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å (–ø–∞—Ä—Ñ—é–º)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–∞–∫—Ä—É—Ç–∫–∏: —Å–∞–º–æ–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏

## ‚è∞ –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

- **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 10:00** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫, –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∑–∞ 3 –¥–Ω—è –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 11:00** - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üîí –ó–∞—â–∏—Ç–∞

- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–∞–∫—Ä—É—Ç–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (—Å–∞–º–æ–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ)
- –ë–æ–Ω—É—Å –≤—ã–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py                # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ database/              # –ú–æ–¥–µ–ª–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îú‚îÄ‚îÄ services/              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ user_service.py
‚îÇ   ‚îú‚îÄ‚îÄ tariff_service.py
‚îÇ   ‚îú‚îÄ‚îÄ subscription_service.py
‚îÇ   ‚îú‚îÄ‚îÄ payment_service.py
‚îÇ   ‚îî‚îÄ‚îÄ referral_service.py
‚îú‚îÄ‚îÄ handlers/              # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ start.py
‚îÇ   ‚îú‚îÄ‚îÄ main_menu.py
‚îÇ   ‚îú‚îÄ‚îÄ subscription.py
‚îÇ   ‚îî‚îÄ‚îÄ payment.py
‚îú‚îÄ‚îÄ keyboards/             # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ main_menu.py
‚îÇ   ‚îî‚îÄ‚îÄ tariff_selection.py
‚îú‚îÄ‚îÄ states/                # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ subscription_states.py
‚îî‚îÄ‚îÄ scheduler/             # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
    ‚îî‚îÄ‚îÄ tasks.py
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ YooKassa

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ [YooKassa](https://yookassa.ru/)
2. –ü–æ–ª—É—á–∏—Ç–µ Shop ID –∏ Secret Key
3. –£–∫–∞–∂–∏—Ç–µ –∏—Ö –≤ `.env`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ YooKassa
3. –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
4. –°–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î

## üé® UX

–ë–æ—Ç –∏–º–µ–µ—Ç –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏:

- üì¶ –ú–æ–π —Ç–∞—Ä–∏—Ñ - –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏
- üîÑ –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É - –≤—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
- üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Å—Å—ã–ª–∫–∞
- üìû –ó–∞–∫–∞–∑–∞—Ç—å –ø–∞—Ä—Ñ—é–º - –∫–æ–Ω—Ç–∞–∫—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
